import React from 'react';
import {
  Box,
  Typography,
  Paper,
  Grid,
  Button,
  LinearProgress,
  Stack,
  Divider,
} from '@mui/material';
import ReplayIcon from '@mui/icons-material/Replay';

// Import the extracted child components
import GeneralSummaryCard from './GeneralSummaryCard';
import TypeCard from './TypeCard';

// The main summary component, now acting as a clean layout/orchestrator.
const VulnerabilitySummary = ({ summary, onReset }) => {
  // Display a loading state if the summary data isn't ready yet.
  if (!summary || !summary.overall || !summary.byType) {
    return (
      <Paper elevation={3} sx={{ p: 2, borderRadius: '12px' }}>
        <Typography>Calculando resumen...</Typography>
        <LinearProgress sx={{ mt: 1 }} />
      </Paper>
    );
  }

  return (
    <Box >
      {/* Header Section */}
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h5" component="h2" sx={{ fontWeight: 'bold' }}>
          Resumen
        </Typography>
        <Button variant="outlined" color="secondary" size="small" startIcon={<ReplayIcon />} onClick={onReset}>
          Reiniciar An√°lisis
        </Button>
      </Box>

      <Stack 
        direction="row"
        divider={<Divider orientation="vertical" flexItem />}
        spacing={2}
      >
      <GeneralSummaryCard data={summary.overall}/>

      {Object.entries(summary.byType).map(([typeName, typeData]) => (   
            <TypeCard  key={typeName} title={typeName} data={typeData} />
        ))}

      </Stack>
    </Box>
  );
};

export default VulnerabilitySummary;
